{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _jsxFileName = \"/Users/owen/Sites/macron-web/pages/index.js\",\n    _s = $RefreshSig$();\n\nvar __jsx = React.createElement;\nimport React, { useEffect, useState } from 'react';\nimport { message, Modal } from 'antd';\nimport Placeholder from '../components/Placeholder';\nimport Sidebar from '../components/Sidebar';\nimport Editor from '../components/Editor';\nimport { placeholder, endpoint } from \"../utils/helpers\";\nimport { fire } from \"../utils/events\";\n\nfunction App() {\n  _s();\n\n  var _useState = useState([]),\n      jobs = _useState[0],\n      setJobs = _useState[1];\n\n  var _useState2 = useState(null),\n      job = _useState2[0],\n      setJob = _useState2[1];\n\n  var connect = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var selected,\n          res,\n          js,\n          _args = arguments;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              selected = _args.length > 0 && _args[0] !== undefined ? _args[0] : null;\n              _context.next = 3;\n              return fetch(endpoint('get'));\n\n            case 3:\n              res = _context.sent;\n              _context.next = 6;\n              return res.json();\n\n            case 6:\n              js = _context.sent;\n              setJobs(js);\n\n            case 8:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function connect() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var onCreate = function onCreate() {\n    if (job && !job.key) {\n      return 'already an unsaved job.';\n    }\n\n    fire('new-job');\n    var b = placeholder();\n    return setJob(b);\n  };\n\n  var onCancel = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var res, js;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              message.success('Changes cancelled.');\n              setJob(null);\n              _context2.next = 4;\n              return fetch(endpoint('refresh'));\n\n            case 4:\n              res = _context2.sent;\n              _context2.next = 7;\n              return res.json();\n\n            case 7:\n              js = _context2.sent;\n              setJobs(js);\n\n            case 9:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function onCancel() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var onSave = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(j, payload) {\n      var data, res, _yield$res$json, job, jobs, error;\n\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              data = {\n                key: j.key,\n                command: payload.command,\n                comment: payload.name,\n                interval: [payload.minute, payload.hour, payload.day, payload.month, payload.weekday].join(' ')\n              };\n              _context3.next = 3;\n              return fetch(endpoint('save'), {\n                method: 'POST',\n                body: JSON.stringify(data)\n              });\n\n            case 3:\n              res = _context3.sent;\n              _context3.next = 6;\n              return res.json();\n\n            case 6:\n              _yield$res$json = _context3.sent;\n              job = _yield$res$json.job;\n              jobs = _yield$res$json.jobs;\n              error = _yield$res$json.error;\n\n              if (!error) {\n                _context3.next = 12;\n                break;\n              }\n\n              return _context3.abrupt(\"return\", message.error(error));\n\n            case 12:\n              setJobs(jobs);\n              setJob(job);\n              return _context3.abrupt(\"return\", message.success(\"\".concat(job.name, \" saved.\")));\n\n            case 15:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    return function onSave(_x, _x2) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var onDelete = function onDelete(j) {\n    Modal.confirm({\n      title: j.name,\n      content: \"Are you sure you want to delete this job?\",\n      onOk: function () {\n        var _onOk = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n          var res, jobs;\n          return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n            while (1) {\n              switch (_context4.prev = _context4.next) {\n                case 0:\n                  _context4.next = 2;\n                  return fetch(endpoint('delete'), {\n                    method: 'POST',\n                    body: j.key\n                  });\n\n                case 2:\n                  res = _context4.sent;\n                  _context4.next = 5;\n                  return res.json();\n\n                case 5:\n                  jobs = _context4.sent;\n                  setJobs(jobs);\n                  setJob(null);\n                  message.error(\"\".concat(j.name, \" deleted.\"));\n\n                case 9:\n                case \"end\":\n                  return _context4.stop();\n              }\n            }\n          }, _callee4);\n        }));\n\n        function onOk() {\n          return _onOk.apply(this, arguments);\n        }\n\n        return onOk;\n      }()\n    });\n  };\n\n  useEffect(function () {\n    var load = /*#__PURE__*/function () {\n      var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5() {\n        var res, js;\n        return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                _context5.next = 2;\n                return fetch(endpoint('refresh'));\n\n              case 2:\n                res = _context5.sent;\n                _context5.next = 5;\n                return res.json();\n\n              case 5:\n                js = _context5.sent;\n                setJobs(js);\n\n              case 7:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5);\n      }));\n\n      return function load() {\n        return _ref4.apply(this, arguments);\n      };\n    }();\n\n    load();\n  }, []);\n  return __jsx(React.Fragment, null, __jsx(\"div\", {\n    className: \"flex flex-wrap min-h-screen\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 9\n    }\n  }, __jsx(\"nav\", {\n    className: \"w-1/4\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 11\n    }\n  }, __jsx(Sidebar, {\n    onCreate: onCreate,\n    jobs: jobs,\n    job: job,\n    onSelect: setJob,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 13\n    }\n  })), __jsx(\"div\", {\n    className: \"w-3/4\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 11\n    }\n  }, job ? __jsx(Editor, {\n    onCancel: onCancel,\n    onSave: onSave,\n    onDelete: onDelete,\n    job: job,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 17\n    }\n  }) : __jsx(Placeholder, {\n    onCreate: onCreate,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 118,\n      columnNumber: 17\n    }\n  }))));\n}\n\n_s(App, \"QBcdKph+DAEFtWJ6O9M8DY/HMmo=\");\n\n_c = App;\nexport default App;\n\nvar _c;\n\n$RefreshReg$(_c, \"App\");","map":{"version":3,"sources":["/Users/owen/Sites/macron-web/pages/index.js"],"names":["React","useEffect","useState","message","Modal","Placeholder","Sidebar","Editor","placeholder","endpoint","fire","App","jobs","setJobs","job","setJob","connect","selected","fetch","res","json","js","onCreate","key","b","onCancel","success","onSave","j","payload","data","command","comment","name","interval","minute","hour","day","month","weekday","join","method","body","JSON","stringify","error","onDelete","confirm","title","content","onOk","load"],"mappings":"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","sourcesContent":["import React, {useEffect, useState} from 'react';\nimport {message, Modal} from 'antd';\nimport Placeholder from '../components/Placeholder';\nimport Sidebar from '../components/Sidebar';\nimport Editor from '../components/Editor';\nimport {placeholder, endpoint} from \"../utils/helpers\";\nimport {fire} from \"../utils/events\";\n\nfunction App() {\n  const [jobs, setJobs] = useState([]);\n  const [job, setJob] = useState(null);\n\n  const connect = async (selected = null) => {\n    const res = await fetch(endpoint('get'))\n    const js = await res.json();\n\n    setJobs(js);\n  };\n\n  const onCreate = () => {\n    if (job && !job.key) {\n      return 'already an unsaved job.';\n    }\n\n    fire('new-job');\n\n    const b = placeholder();\n    return setJob(b);\n  };\n\n  const onCancel = async () => {\n    message.success('Changes cancelled.');\n    setJob(null);\n\n    const res = await fetch(endpoint('refresh'))\n    const js = await res.json();\n\n    setJobs(js);\n  };\n\n  const onSave = async (j, payload) => {\n    const data = {\n      key: j.key,\n      command: payload.command,\n      comment: payload.name,\n      interval: [\n        payload.minute,\n        payload.hour,\n        payload.day,\n        payload.month,\n        payload.weekday\n      ].join(' '),\n    };\n\n    const res = await fetch(endpoint('save'), {\n      method: 'POST',\n      body: JSON.stringify(data)\n    })\n\n    const {job, jobs, error} = await res.json();\n\n    if (error) {\n      return message.error(error);\n    }\n\n    setJobs(jobs);\n    setJob(job);\n\n    return message.success(`${job.name} saved.`);\n  };\n\n  const onDelete = j => {\n    Modal.confirm({\n      title: j.name,\n      content: `Are you sure you want to delete this job?`,\n      onOk: async () => {\n        const res = await fetch(endpoint('delete'), {\n          method: 'POST',\n          body: j.key\n        })\n\n        const jobs = await res.json();\n\n        setJobs(jobs);\n        setJob(null);\n\n        message.error(`${j.name} deleted.`);\n      }\n    });\n  };\n\n  useEffect(() => {\n    const load = async () => {\n      const res = await fetch(endpoint('refresh'))\n      const js = await res.json();\n\n      setJobs(js);\n    }\n\n    load();\n  }, [])\n\n  return (\n      <>\n        <div className=\"flex flex-wrap min-h-screen\">\n          <nav className=\"w-1/4\">\n            <Sidebar onCreate={onCreate} jobs={jobs} job={job} onSelect={setJob}/>\n          </nav>\n          <div className=\"w-3/4\">\n            {job ? (\n                <Editor\n                    onCancel={onCancel}\n                    onSave={onSave}\n                    onDelete={onDelete}\n                    job={job}\n                />\n            ) : (\n                <Placeholder onCreate={onCreate}/>\n            )}\n          </div>\n        </div>\n      </>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}