{"ast":null,"code":"function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\n\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\n\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nfunction _iterableToArrayLimit(arr, i) { if (typeof Symbol === \"undefined\" || !(Symbol.iterator in Object(arr))) return; var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\nimport React, { useState } from 'react';\nimport { message, Modal } from 'antd';\nimport Placeholder from '../components/Placeholder';\nimport Sidebar from '../components/Sidebar';\nimport Editor from '../components/Editor';\nimport { placeholder } from \"../utils/helpers\";\nimport { fire } from \"../utils/events\";\n\nfunction App(_ref) {\n  var initialJobs = _ref.initialJobs;\n\n  var _useState = useState(initialJobs),\n      _useState2 = _slicedToArray(_useState, 2),\n      jobs = _useState2[0],\n      setJobs = _useState2[1];\n\n  var _useState3 = useState(null),\n      _useState4 = _slicedToArray(_useState3, 2),\n      job = _useState4[0],\n      setJob = _useState4[1];\n\n  var connect = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {\n      var selected,\n          res,\n          js,\n          _args = arguments;\n      return regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              selected = _args.length > 0 && _args[0] !== undefined ? _args[0] : null;\n              _context.next = 3;\n              return fetch('http://localhost:3000/api/get');\n\n            case 3:\n              res = _context.sent;\n              _context.next = 6;\n              return res.json();\n\n            case 6:\n              js = _context.sent;\n              setJobs(js);\n\n            case 8:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function connect() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var onCreate = function onCreate() {\n    if (job && !job.key) {\n      return 'already an unsaved job.';\n    }\n\n    fire('new-job');\n    var b = placeholder();\n    return setJob(b);\n  };\n\n  var onCancel = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2() {\n      var res, js;\n      return regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              message.success('Changes cancelled.');\n              setJob(null);\n              _context2.next = 4;\n              return fetch('http://localhost:3000/api/refresh');\n\n            case 4:\n              res = _context2.sent;\n              _context2.next = 7;\n              return res.json();\n\n            case 7:\n              js = _context2.sent;\n              setJobs(js);\n\n            case 9:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function onCancel() {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var onSave = /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee3(j, payload) {\n      var data, res, _yield$res$json, job, jobs, error;\n\n      return regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              data = {\n                key: j.key,\n                command: payload.command,\n                comment: payload.name,\n                interval: [payload.minute, payload.hour, payload.day, payload.month, payload.weekday].join(' ')\n              };\n              _context3.next = 3;\n              return fetch('http://localhost:3000/api/save', {\n                method: 'POST',\n                body: JSON.stringify(data)\n              });\n\n            case 3:\n              res = _context3.sent;\n              _context3.next = 6;\n              return res.json();\n\n            case 6:\n              _yield$res$json = _context3.sent;\n              job = _yield$res$json.job;\n              jobs = _yield$res$json.jobs;\n              error = _yield$res$json.error;\n\n              if (!error) {\n                _context3.next = 12;\n                break;\n              }\n\n              return _context3.abrupt(\"return\", message.error(error));\n\n            case 12:\n              setJobs(jobs);\n              setJob(job);\n              return _context3.abrupt(\"return\", message.success(\"\".concat(job.name, \" saved.\")));\n\n            case 15:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    return function onSave(_x, _x2) {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  var onDelete = function onDelete(j) {\n    Modal.confirm({\n      title: j.name,\n      content: \"Are you sure you want to delete this job?\",\n      onOk: function () {\n        var _onOk = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee4() {\n          var res, jobs;\n          return regeneratorRuntime.wrap(function _callee4$(_context4) {\n            while (1) {\n              switch (_context4.prev = _context4.next) {\n                case 0:\n                  _context4.next = 2;\n                  return fetch('http://localhost:3000/api/delete', {\n                    method: 'POST',\n                    body: j.key\n                  });\n\n                case 2:\n                  res = _context4.sent;\n                  _context4.next = 5;\n                  return res.json();\n\n                case 5:\n                  jobs = _context4.sent;\n                  setJobs(jobs);\n                  setJob(null);\n                  message.error(\"\".concat(j.name, \" deleted.\"));\n\n                case 9:\n                case \"end\":\n                  return _context4.stop();\n              }\n            }\n          }, _callee4);\n        }));\n\n        function onOk() {\n          return _onOk.apply(this, arguments);\n        }\n\n        return onOk;\n      }()\n    });\n  };\n\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"flex flex-wrap min-h-screen\"\n  }, /*#__PURE__*/React.createElement(\"nav\", {\n    className: \"w-1/4\"\n  }, /*#__PURE__*/React.createElement(Sidebar, {\n    onCreate: onCreate,\n    jobs: jobs,\n    job: job,\n    onSelect: setJob\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"w-3/4\"\n  }, job ? /*#__PURE__*/React.createElement(Editor, {\n    onCancel: onCancel,\n    onSave: onSave,\n    onDelete: onDelete,\n    job: job\n  }) : /*#__PURE__*/React.createElement(Placeholder, {\n    onCreate: onCreate\n  }))));\n}\n\nexport var getServerSideProps = /*#__PURE__*/function () {\n  var _ref5 = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee5() {\n    var res;\n    return regeneratorRuntime.wrap(function _callee5$(_context5) {\n      while (1) {\n        switch (_context5.prev = _context5.next) {\n          case 0:\n            _context5.prev = 0;\n            _context5.next = 3;\n            return fetch('http://localhost:3000/api/refresh');\n\n          case 3:\n            res = _context5.sent;\n            _context5.next = 6;\n            return res.json();\n\n          case 6:\n            _context5.t0 = _context5.sent;\n            _context5.t1 = {\n              initialJobs: _context5.t0\n            };\n            return _context5.abrupt(\"return\", {\n              props: _context5.t1\n            });\n\n          case 11:\n            _context5.prev = 11;\n            _context5.t2 = _context5[\"catch\"](0);\n            return _context5.abrupt(\"return\", {\n              props: {\n                initialJobs: []\n              }\n            });\n\n          case 14:\n          case \"end\":\n            return _context5.stop();\n        }\n      }\n    }, _callee5, null, [[0, 11]]);\n  }));\n\n  return function getServerSideProps() {\n    return _ref5.apply(this, arguments);\n  };\n}();\nexport default App;","map":null,"metadata":{},"sourceType":"module"}